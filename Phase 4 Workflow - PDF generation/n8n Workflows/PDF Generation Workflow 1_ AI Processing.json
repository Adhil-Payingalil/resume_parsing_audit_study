{
  "name": "PDF Generation Workflow 1: AI Processing",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "1980a2d5-7906-462b-8d95-ae2ba0579a36",
        "authentication": "basicAuth",
        "responseMode": "responseNode",
        "options": {
          "rawBody": false
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        2064,
        2384
      ],
      "id": "b37079e8-de6e-4e35-844f-33ce331a1bb2",
      "name": "Webhook",
      "webhookId": "1980a2d5-7906-462b-8d95-ae2ba0579a36",
      "credentials": {
        "httpBasicAuth": {
          "id": "WjnSubEirDdvkiFa",
          "name": "adhil"
        }
      }
    },
    {
      "parameters": {
        "collection": "Treated_resumes",
        "options": {},
        "query": "={\n  \"$and\": [\n    { \"original_file_id\": \"{{ $json.body.file_id }}\" },\n    { \"treatment_type\": \"{{ $json.body.treatment_type }}\" }\n  ]\n}"
      },
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.2,
      "position": [
        2288,
        2384
      ],
      "id": "c385b4c3-415c-4183-bc67-3f281262faa5",
      "name": "Find documents",
      "credentials": {
        "mongoDb": {
          "id": "M1ISL6y9nE1CM4BJ",
          "name": "MongoDB account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// input: $input.first().json.candidates[0].content.parts[0].text\nconst raw = $input.first().json.output;\nlet clean = raw.trim();\n\nif (clean.startsWith('```markdown')) {\n  clean = clean.slice('```markdown'.length).trim();\n}\nif (clean.startsWith('```')) {\n  clean = clean.slice(3).trim();\n}\nif (clean.endsWith('```')) {\n  clean = clean.slice(0, -3).trim();\n}\n\nreturn [{ json: { llm_raw_text_clean: clean } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4240,
        2384
      ],
      "id": "6911381b-12dc-42fb-a7ff-28592548a53a",
      "name": "Remove formatting of AI",
      "executeOnce": false
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3968,
        2496
      ],
      "id": "7aba7f5e-07ba-4dd8-8989-169d874ac470",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "QQhGTBY85rcfOxcY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "51345a1a-11be-4bb0-8100-b525f14111ac",
              "name": "=resume_data.resume_data.basics.name",
              "value": "={{ $('Webhook').item.json.body.name }}",
              "type": "string"
            },
            {
              "id": "41646588-5539-4e55-8637-14d4137ca007",
              "name": "resume_data.resume_data.basics.email",
              "value": "={{ $('Webhook').item.json.body.email }}",
              "type": "string"
            },
            {
              "id": "ec597634-1ea2-421b-b577-43c252ee1e4a",
              "name": "resume_data.resume_data.basics.phone",
              "value": "={{ $('Webhook').item.json.body.phone }}",
              "type": "string"
            },
            {
              "id": "c3258cee-7e10-4720-a846-df55f09c78f5",
              "name": "resume_data.resume_data.basics.location",
              "value": "={{ $('Webhook').item.json.body.location }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2512,
        2384
      ],
      "id": "a9894654-446c-494f-94a6-83f596f49043",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.markdown_template }}",
                    "rightValue": 1,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "fc4ac248-ec58-45bb-aa1f-ddb9e8fb8916"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4d9a0b18-b431-45c7-aaed-794fe9d53409",
                    "leftValue": "={{ $('Webhook').item.json.body.markdown_template }}",
                    "rightValue": 2,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "253f8eac-ba92-4d8b-bd34-e8caf13f996a",
                    "leftValue": "={{ $('Webhook').item.json.body.markdown_template }}",
                    "rightValue": 3,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3664,
        2368
      ],
      "id": "dac2a4bd-7691-4b0e-a64e-67b088dca36b",
      "name": "Switch"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Resume data: \n {{ $json.candidates[0].content.parts[0].text }}",
        "options": {
          "systemMessage": "=You are an expert markdown resume creator. You will rewrite a given resume in a specific markdown format without changing the resume format a lot. \n\nYou will be provided with a resume (in text, JSON, or other structured format), and your task is to adapt its content into the markdown template below. Preserve the original content, structure, and facts as closely as possible—do not add, remove, or invent details. Only rephrase minimally for clarity or flow if needed, and map sections directly to the template. \n\nOutput only the filled markdown resume in ```markdown block, without any additional text, explanations, or code blocks. \n\nIMPORTANT: DO NOT add any comments or placeholderes if anything is missing (Make sure of this before output).\n\nMarkdown template:\n# [Full Name]\n\n[City, Region] | [Phone] | [Email] \n\n## Professional Summary\n[A brief 3-5 sentence summary highlighting key expertise, experience, and career goals, adapted from the original.]\n\n## Work Experience\n### [Position]  \n**[Company], [Location]**  \n[Start Date] - [End Date]  \n\n- [Achievement or responsibility 1, rephrased if needed for conciseness]  \n- [Achievement or responsibility 2]  \n- [And so on for all original bullets]  \n\n[Repeat for each work entry]\n\n## Education\n### [Study Type] in [Area]  \n[Institution], [Location]  \n[End Date]  \n\n[Optional: Score/GPA if present in original]\n\n[Repeat for each education entry]\n\n## Skills\n- **[Skill Group 1]:** [Keyword 1], [Keyword 2], [Keyword 3]  \n- **[Skill Group 2]:** [Keyword 1], [Keyword 2], [Keyword 3]\n- **[Skill Group 3]:** [Keyword 1], [Keyword 2], [Keyword 3]\n- [And so on, using the skill groups and keywords from the original]\n\n## Languages\n- **[Language 1]:** [Fluency Level]\n- **[Language 2]:** [Fluency Level]\n- [And so on for all languages]\n\n## Certifications\n- [Certification Name], ([Issuing Organization], [Date])  \n- [And so on for all certifications]\n\n## Volunteer Experience\n### [Position/Role]  \n**[Organization], [Location]**  \n[Start Date] - [End Date]  \n\n- [Achievement or responsibility 1]  \n- [Achievement or responsibility 2]  \n- [And so on for all original bullets]  \n\n[Repeat for each volunteer entry]\n\n---\n\n[If the original resume has additional sections like Awards, Publications, or other custom sections, add them similarly at the end using H2 headers (## Section Name) and appropriate formatting.]"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3888,
        1872
      ],
      "id": "84b54d40-03f8-40af-844d-122ad861b4b4",
      "name": "AI Agent MD template 1",
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Resume data: \n {{ $json.candidates[0].content.parts[0].text }}",
        "options": {
          "systemMessage": "=You are an expert markdown resume creator. You will rewrite a given resume in a specific markdown format without changing the resume format a lot. \n\nYou will be provided with a resume (in text, JSON, or other structured format), and your task is to adapt its content into the markdown template below. Preserve the original content, structure, and facts as closely as possible—do not add, remove, or invent details. Only rephrase minimally for clarity or flow if needed, and map sections directly to the template. \n\nOutput only the filled markdown resume in ```markdown block, without any additional text, explanations, or code blocks. \n\nIMPORTANT: DO NOT add any comments or placeholderes if anything is missing (Make sure of this before output).\n\nMarkdown template:\n# [Full Name]\n\n[Email] • [Phone] • [City, Region]\n\n## Summary\n[A brief 3-5 sentence summary highlighting key expertise, experience, and career goals, adapted from the original.]\n\n## Skills\n- **[Skill Group 1]:** [Keyword 1], [Keyword 2], [Keyword 3], [Keyword 4], [Keyword 5]  \n- **[Skill Group 2]:** [Keyword 1], [Keyword 2], [Keyword 3], [Keyword 4], [Keyword 5]  \n- **[Skill Group 3]:** [Keyword 1], [Keyword 2], [Keyword 3], [Keyword 4], [Keyword 5]\n\n## Professional Experience\n### [Position] | [Company]\n*[Start Date] - [End Date] | [Location]*\n\n- [Achievement or responsibility 1]  \n- [Achievement or responsibility 2]  \n- [And so on for all original bullets]  \n\n[Repeat for each work entry]\n\n## Education\n### [Study Type] in [Area] | [Institution]\n*[End Date] | [Location]*\n\n[Optional: Score/GPA if present in original]\n\n[Repeat for each education entry]\n\n## Languages\n- **[Language 1]:** [Fluency Level]  \n- **[Language 2]:** [Fluency Level]  \n- **[Language 3]:** [Fluency Level]\n\n## Certifications\n- [Certification Name] - [Issuing Organization] ([Date])  \n- [And so on for all certifications]\n\n## Volunteer Experience\n### [Position/Role] | [Organization]\n*[Start Date] - [End Date] | [Location]*\n\n- [Achievement or responsibility 1]  \n- [Achievement or responsibility 2]  \n- [And so on for all original bullets]  \n\n[Repeat for each volunteer entry]\n\n---\n\n[If the original resume has additional sections like Awards, Publications, or other custom sections, add them similarly at the end using H2 headers (## Section Name) and appropriate formatting.]\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3888,
        2272
      ],
      "id": "96ea29f0-5c86-47ab-9e77-4b0b6d879d64",
      "name": "AI Agent MD template 2",
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Resume data: \n {{ $json.candidates[0].content.parts[0].text }}",
        "options": {
          "systemMessage": "=You are an expert markdown resume creator. You will rewrite a given resume in a specific markdown format without changing the resume format a lot. \n\nYou will be provided with a resume (in text, JSON, or other structured format), and your task is to adapt its content into the markdown template below. Preserve the original content, structure, and facts as closely as possible—do not add, remove, or invent details. Only rephrase minimally for clarity or flow if needed, and map sections directly to the template. \n\nOutput only the filled markdown resume in ```markdown block, without any additional text, explanations, or code blocks. \n\nIMPORTANT: DO NOT add any comments or placeholderes if anything is missing (Make sure of this before output).\n\nMarkdown template:\n# [Full Name]\n\n[Email] | [Phone] | [Location]\n\n## Experience\n**[Position]**  \n[Company] | [Start Date] - [End Date]  \n[Location]\n\n- [Achievement or responsibility 1]  \n- [Achievement or responsibility 2]  \n- [And so on for all original bullets]  \n\n[Repeat for each work entry]\n\n## Education\n**[Study Type] in [Area]**  \n[Institution] | [End Date]  \n[Location]\n\n[Optional: Score/GPA if present in original]\n\n[Repeat for each education entry]\n\n## Skills\n- **[Skill Group 1]:** [Keyword 1], [Keyword 2], [Keyword 3]  \n- **[Skill Group 2]:** [Keyword 1], [Keyword 2], [Keyword 3]  \n- **[Skill Group 3]:** [Keyword 1], [Keyword 2], [Keyword 3]  \n- **[Skill Group 4]:** [Keyword 1], [Keyword 2], [Keyword 3]  \n- **[Skill Group 5]:** [Keyword 1], [Keyword 2], [Keyword 3]\n\n## Languages\n- **[Language 1]:** [Fluency Level]  \n- **[Language 2]:** [Fluency Level]  \n- **[Language 3]:** [Fluency Level]\n\n## Certifications\n- [Certification Name] ([Issuing Organization], [Date])  \n- [And so on for all certifications]\n\n## Volunteer Experience\n**[Position/Role]**  \n[Organization] | [Start Date] - [End Date]  \n[Location]\n\n- [Achievement or responsibility 1]  \n- [Achievement or responsibility 2]  \n- [And so on for all original bullets]  \n\n[Repeat for each volunteer entry]\n\n---\n\n[If the original resume has additional sections like Awards, Publications, or other custom sections, add them similarly at the end using H2 headers (## Section Name) and appropriate formatting.]\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3888,
        2784
      ],
      "id": "9668fc45-2ab7-463b-9f59-75096cace1ae",
      "name": "AI agent MD template 3",
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3968,
        3008
      ],
      "id": "f768c6f9-b8b4-44a0-9f64-151841f112ac",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "QQhGTBY85rcfOxcY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3968,
        2096
      ],
      "id": "09ad96b8-d956-4fb2-93fa-52fcb0ee92e2",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "QQhGTBY85rcfOxcY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "=Resume Data (JSON):\n{{ JSON.stringify($('Edit Fields').item.json.resume_data.resume_data) }}\n\nJob Description (JD):\n{{ $('Webhook').item.json.body.job_description }}\n\nJD Title:\n{{ $('Webhook').item.json.body.job_title }}\n\nTreatment Type:\n{{ $('Webhook').item.json.body.treatment_type }}\n\nJD Keywords And Buckets:\n{{ $('Keyword Extractor').item.json.candidates[0].content.parts[0].text }}\n\nStyle Guide:\n{{ $('Find documents').item.json.style_guide || \"using a direct, concise, and professional tone, prioritizing clarity and brevity\" }}"
            }
          ]
        },
        "simplify": false,
        "jsonOutput": true,
        "options": {
          "systemMessage": "You are an expert resume optimizer focused on ATS alignment and human readability. Tailor the provided JSON resume to the given Job Description (JD) so it reads naturally, mirrors the JD's priorities, and ranks highly in ATS—without altering core identity or chronology.\n\n**Inputs:**\n- resume_json: original resume JSON to tailor\n- jd_text: full job description\n- jd_title: job title\n- treatment_type: one of [\"control\",\"Type_I\",\"Type_II\",\"Type_III\"]\n- jd_keywords (optional): prioritized JD keywords/phrases (may be provided as JSON string from extractor)\n- style_guide (optional): style modifier  (guides how to rephrase)\n\n**Non‑negotiables (identity integrity):**\n- Keep the person's identity, employers, job titles, locations, and date ranges as-is. Do not add new employers or change dates/locations.\n- Keep education institutions and degrees accurate (no new institutions or degrees).\n- Do not fabricate hard metrics if none exist; use qualitative outcomes instead.\n- Do NOT change section order or layout here (that is handled downstream).\n- Preserve the JSON schema exactly (same top‑level sections/fields). Only enrich existing sections.\n\n**Allowed, context‑consistent enhancements (to maximize JD fit):**\n- Professional Summary: rewrite (2–4 sentences) to reflect the JD's themes (core skills, responsibilities, domain) in a natural, non‑robotic tone.\n- Skills: expand/refine to include JD‑relevant skills or tools that are reasonably consistent with the work history. You may add up to 6–10 closely related skills (e.g., categories like analytics, collaboration tools, advertising platforms, testing frameworks, CRMs, design/engineering tooling, domain‑specific software) if plausible from the roles. Prefer precise JD terms. Avoid keyword stuffing; group logically.\n- Certifications: you may lightly rename or consolidate titles for clarity (keep issuer and dates plausible if Cloud‑present). Do not invent new issuing bodies or dates. Remove only items explicitly instructed upstream (if any).\".any certificates are not relevant to the JD, remove them.\n- Experience bullets: rewrite to integrate JD language (responsibilities, collaboration, measurement/optimization, client‑facing) and improve clarity/impact. You may add up to 1 new responsibility‑level bullet per role if it is a plausible, non‑metric statement consistent with the role and industry. Do not move responsibilities to an employer where it would be implausible.\n- Within each position, randomly reorder the bullets. Do not mention or allude to this reordering in the output.\n- If a work bullet mentions a specific employer or client by name, replace that name with a generic reference (e.g., \"the company\" or \"the client\") while preserving the factual responsibility and outcome. Do not disclose identifiable brand names in bullets.\n\n**Dynamic JD alignment:**\n1) If jd_keywords/buckets are provided as a JSON string, parse it first to extract the jd_key.zeros array and buckets object. If they are absent or not parseable, extract 15–25 high‑value keywords/phrases from jd_text (skills, responsibilities, tools, domain concepts, collaboration patterns, measurement/optimization, client interaction).\n2) Thread these terms naturally into Skills and relevant bullets—only when consistent with resume_json and role context.\n3) Ensure at least one bullet (where applicable) reflects one of these universal themes when present in the JD:\n   - Strategy/Planning (e.g., roadmaps, frameworks, structured approaches)\n   - Measurement/Optimization/Experimentation (e.g., KPIs, testing, iteration)\n   - Cross‑functional collaboration (e.g., with adjacent teams or stakeholders)\n   - External collaboration (e.g., partners, vendors, clients, agencies)\n   - Client‑facing presentation and sell‑through (if the JD implies stakeholder communication)\n   - Platform/Tool fluency (domain‑appropriate systems or software referenced in the JD)\n\n**Style modifier :**\n- If style_guide is provided, follow its instructions for HOW to rephrase (verb choice, tone, emphasis) while optimizing to the JD.\n- Apply style_guide consistently across summary and experience bullets; affects writing style, not content facts.\n- If no style_guide, use standard professional tone with varied action verbs.\n\n**Uniform length controls (apply to all cases):**\n- Summary: 2–4 sentences.\n- Skills: 10–16 total (grouped and most relevant to JD), ≤5–6 per group.\n- Experience: 3–5 bullets per role; one idea per bullet; similar sentence length across treatments.\n- No new roles; max 1 added bullet per role (plausible responsibility).\n\n**Tone and readability:**\n- Human, concise, and varied. Strong action verbs; avoid repetitive openings.\n- Blend JD terms naturally; avoid robotic keyword stuffing.\n- One idea per bullet; avoid superlatives; prefer concrete responsibilities.\n\n**Output rules:**\n- Return ONLY the tailored resume JSON (valid JSON), preserving the exact schema of resume_json.\n- Do NOT include explanations, markdown, or any extra fields outside the existing schema."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        3312,
        2384
      ],
      "id": "0cfacd65-b612-4654-8bb8-0b298b28401f",
      "name": "Doc Tailoring Agent",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "QQhGTBY85rcfOxcY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=Job Description:\n{{ $('Webhook').item.json.body.job_description }}"
            }
          ]
        },
        "simplify": false,
        "jsonOutput": true,
        "options": {
          "systemMessage": "Extract ATS-relevant terms from the job description and return ONLY a compact JSON object with this shape: {   \"jd_keywords\": [string],              // 20–30 unique, prioritized keywords/phrases   \"buckets\": {     \"planning_strategy\": [string],      // frameworks, strategy/roadmaps, structured approaches     \"measurement_optimization\": [string], // KPIs, testing, analytics, iteration     \"cross_functional\": [string],       // collaboration with adjacent teams/stakeholders     \"external_collab\": [string],        // clients, partners, vendors, agencies     \"stakeholder_comms\": [string],      // presentation, sell-through, executive comms     \"platforms_tools\": [string]         // domain-appropriate systems/tools (ads, analytics, CRM, etc.)   } }  Rules: - Use only terms that appear in or are obvious synonyms of the JD. - Deduplicate, normalize case, keep phrases (2–4 words) when meaningful. - No explanations, no extra fields, just the JSON object above."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        2960,
        2384
      ],
      "id": "c4dad78b-e93f-47b6-8ab4-3a8b724b3d20",
      "name": "Keyword Extractor",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "QQhGTBY85rcfOxcY",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "=Resume (final text):\n{{ $('Remove formatting of AI').item.json.llm_raw_text_clean }}\n\nJD Text:\n{{ $('Webhook').item.json.body.job_description }}\n\nJD Keywords:\n{{ JSON.stringify($('Keyword Extractor').item.json.jd_keywords || []) }}\n\n"
            }
          ]
        },
        "jsonOutput": true,
        "options": {
          "systemMessage": "You are a strict resume QA validator. Review the resume text and return ONLY this compact JSON (no extra text):\n\n{\n  \"quality_score\": 0-100,\n  \"critical\": {\n    \"placeholders\": true|false,\n    \"ai_filler\": true|false,\n    \"section_integrity_fail\": true|false\n  },\n  \"jd_alignment\": {\n    \"jd_resume_match\": 0-100,\n    \"keyword_hits\": number\n  },\n  \"notes\": [string]\n}\n\nRules:\n- Compute jd_resume_match from JD keyword coverage: let min_required=12; if keyword_hits >= 12 → 100; else 100 − 5 × (12 − keyword_hits); clamp 0–100.\n- Score: start quality_score = 100, subtract 50 if placeholders, 25 if ai_filler, 10 if section_integrity_fail, then subtract (100 − jd_resume_match) capped at 40. Clamp 0–100.\n- Only evaluate these fields; do not add others.\n- Current date is 2025; do not flag dates on/before 2025.\n- Notes: include up to 2 brief items only when a critical flag is true; otherwise return [].\n- Be precise; prefer no false positives. Do not rewrite content. Return the JSON only."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        4688,
        2384
      ],
      "id": "8e887ee7-9cfe-416c-af38-7e89a2b782c0",
      "name": "Resume Validation",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "credentials": {
        "googlePalmApi": {
          "id": "QQhGTBY85rcfOxcY",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  // Get data from the Webhook node (since that's where your original data comes from)\n  const webhookData = $('Webhook').first().json.body;\n  \n  console.log('Webhook data:', JSON.stringify(webhookData, null, 2));\n  \n  const treatmentType = webhookData.treatment_type;\n  const firstName = webhookData.first_name;\n  const fullName = webhookData.name;\n  const jobTitle = webhookData.job_title;\n  const company = webhookData.company;\n  \n  console.log('Extracted values:');\n  console.log('Treatment Type:', treatmentType);\n  console.log('First Name:', firstName);\n  console.log('Full Name:', fullName);\n  console.log('Job Title:', jobTitle);\n  console.log('Company:', company);\n  \n  // Create filename based on treatment type\n  let filename = '';\n  if (treatmentType === 'control') {\n    filename = `${firstName}_Resume_${company}_${jobTitle}`;\n  } else if (treatmentType === 'Type_I') {\n    filename = `Resume_${fullName}_${jobTitle}_${company}`;\n  } else if (treatmentType === 'Type_II') {\n    filename = `${firstName}_${jobTitle}_${company}_Resume`;\n  } else if (treatmentType === 'Type_III') {\n    filename = `${fullName}_Resume_${company}_${jobTitle}`;\n  } else {\n    filename = `${firstName}_Resume_${company}_${jobTitle}`;\n  }\n  \n  // Sanitize the filename\n  filename = filename\n    .replace(/[:<>\"|?*]/g, '')\n    .replace(/[()]/g, '')\n    .replace(/\\s+/g, '_')\n    .replace(/_{2,}/g, '_')\n    .trim();\n  \n  item.json.sanitized_filename = filename;\n  \n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4464,
        2384
      ],
      "id": "37e37f7d-8c2a-4353-af7d-1c9b7c5059de",
      "name": "Sanitize filename"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n     \"status\": \"accepted\",\n     \"id\": \"{{ $('Webhook').item.json.body.id }}\",\n     \"treatment_type\": \"{{ $('Webhook').item.json.body.treatment_type }}\",\n     \"message\": \"Processing started - resume will be processed asynchronously\"\n   }",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2736,
        2384
      ],
      "id": "abeeb3ee-3d6c-4ba5-9a6a-8959616e215f",
      "name": "Early Response"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://adhil-is-dummy.app.n8n.cloud/webhook-test/e05131b6-59ea-459b-8b32-58236328f630",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\n{\n\"id\": $json.id,\n\"match_id\": $json.match_id,\n\"u_id\": $json.u_id,\n\"template_id\": $json.template_id,\n\"resume_markdown\": $json.resume_final_markdown,\n\"resume_filename\": $json.resume_filename,\n\"base _resume_file_id\": $json.base_resume_file_id\n}\n}}",
        "options": {
          "response": {
            "response": {
              "neverError": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        5696,
        2368
      ],
      "id": "ae4a671b-725f-48a1-b520-649f07157d20",
      "name": "HTTP Request to Workflow 2",
      "credentials": {
        "httpBasicAuth": {
          "id": "WjnSubEirDdvkiFa",
          "name": "adhil"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cfb51035-7a35-4138-b864-59e068928cc2",
              "name": "u_id",
              "value": "={{$('Webhook').item.json.body.id}}_{{$('Webhook').item.json.body.treatment_type}}",
              "type": "string"
            },
            {
              "id": "72192866-7792-4367-8eb6-f875fa2d8249",
              "name": "match_id",
              "value": "={{$('Webhook').item.json.body.id}}",
              "type": "string"
            },
            {
              "id": "294305f0-aa43-41d8-b3c7-8a7dda346197",
              "name": "treatment_type",
              "value": "={{$('Webhook').item.json.body.treatment_type}}",
              "type": "string"
            },
            {
              "id": "493c1e3d-2f7f-4b6b-99d9-c8da3696d8df",
              "name": "base_resume_file_id",
              "value": "={{$('Webhook').item.json.body.file_id}}",
              "type": "string"
            },
            {
              "id": "8b3a1c7f-39bc-4880-901d-dddda88d7fbe",
              "name": "template_id",
              "value": "={{$('Webhook').item.json.body.template_id}}",
              "type": "string"
            },
            {
              "id": "3d3965c4-7996-4cb3-939f-83394157d5a3",
              "name": "markdown_template",
              "value": "={{$('Webhook').item.json.body.markdown_template}}",
              "type": "string"
            },
            {
              "id": "df692a80-d453-4c4d-b9b3-5f9ffd033d4c",
              "name": "resume_final_markdown",
              "value": "={{$('Remove formatting of AI').item.json.llm_raw_text_clean}}",
              "type": "string"
            },
            {
              "id": "dce69a95-a45f-44cf-90ad-06cb7ce80188",
              "name": "resume_filename",
              "value": "={{$('Sanitize filename').item.json.sanitized_filename}}",
              "type": "string"
            },
            {
              "id": "8b591061-8c22-42d4-ad1a-e6121a8c3f80",
              "name": "full_name",
              "value": "={{ $('Webhook').item.json.body.name }}",
              "type": "string"
            },
            {
              "id": "90952bb5-7a13-44c8-9f0b-7e53de5ea956",
              "name": "email",
              "value": "={{ $('Webhook').item.json.body.email }}",
              "type": "string"
            },
            {
              "id": "ce2920cd-8004-424a-9806-99436bc718d5",
              "name": "phone",
              "value": "={{ $('Webhook').item.json.body.phone }}",
              "type": "string"
            },
            {
              "id": "615ef55f-cbb7-4370-8858-f84bb61fcd5b",
              "name": "first_name",
              "value": "={{ $('Webhook').item.json.body.first_name }}",
              "type": "string"
            },
            {
              "id": "9e03dc40-755e-4f43-a5a1-8027f32a0231",
              "name": "last_name",
              "value": "={{ $('Webhook').item.json.body.last_name }}",
              "type": "string"
            },
            {
              "id": "6a03ba5e-e2ea-4518-aa18-7e95b30eed9b",
              "name": "gender",
              "value": "={{ $('Webhook').item.json.body.gender }}",
              "type": "string"
            },
            {
              "id": "4b8e8f94-0d42-4cfd-93e3-b52bfadebb45",
              "name": "geographic_cluster",
              "value": "={{ $('Webhook').item.json.body.geographic_cluster }}",
              "type": "string"
            },
            {
              "id": "908302fa-8fb7-45e9-b5ec-02eb5a659b32",
              "name": "likely_home_country",
              "value": "={{ $('Webhook').item.json.body.country }}",
              "type": "string"
            },
            {
              "id": "8f44b074-8d26-4583-83c0-69a4126259be",
              "name": "company",
              "value": "={{ $('Webhook').item.json.body.company }}",
              "type": "string"
            },
            {
              "id": "41d690d1-97f3-4f9b-8fb5-2bbe25dee4d7",
              "name": "job_title",
              "value": "={{ $('Webhook').item.json.body.job_title }}",
              "type": "string"
            },
            {
              "id": "1f1c3c3c-085e-40de-83bc-ae589bbfb5bd",
              "name": "job_posting_id",
              "value": "={{ $('Webhook').item.json.body.job_posting_id }}",
              "type": "string"
            },
            {
              "id": "2e048330-2760-478c-9c47-4e2de01e2c7e",
              "name": "match_score",
              "value": "={{ $('Webhook').item.json.body.match_score }}",
              "type": "number"
            },
            {
              "id": "16b6443f-6185-4aff-ae73-9017f5f80a3b",
              "name": "job_url_direct",
              "value": "={{ $('Webhook').item.json.body.job_link }}",
              "type": "string"
            },
            {
              "id": "b051fe1f-7ac4-4896-9222-aa3f6c370848",
              "name": "markdown_template",
              "value": "={{ $('Webhook').item.json.body.markdown_template }}",
              "type": "number"
            },
            {
              "id": "66c4aa14-c12a-4308-8365-9f4dc41ff0bc",
              "name": "validation_score",
              "value": "={{$('Set Validation Output').item.json.final_validation_score}}",
              "type": "string"
            },
            {
              "id": "ab0ff532-f697-4c1e-aff6-7140ce7f9ef7",
              "name": "validation_json",
              "value": "={{$('Set Validation Output').item.json.validation_json}}",
              "type": "string"
            },
            {
              "id": "7689a650-56ba-4b9f-af9e-3d382e93fa59",
              "name": "render_status",
              "value": "pending",
              "type": "string"
            },
            {
              "id": "f39809e2-9141-42dc-adea-eb2aa63b5b0b",
              "name": "created_at",
              "value": "={{ $now }}",
              "type": "string"
            },
            {
              "id": "2a6b5cab-506e-497a-b5b4-a0e1500e5a29",
              "name": "job_description",
              "value": "={{ $('Webhook').item.json.body.job_description }}",
              "type": "string"
            },
            {
              "id": "ac4e8e68-fe91-4a3a-af79-1f2d65a5b84f",
              "name": "job_location",
              "value": "={{ $('Webhook').item.json.body.location }}",
              "type": "string"
            },
            {
              "id": "1d91fdaa-4c01-4ea0-9ab5-0eb8c232b876",
              "name": "workflow_mode",
              "value": "={{ $('Webhook').item.json.executionMode }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5264,
        2368
      ],
      "id": "4ec5fd6c-a40e-4478-bfc2-610153c1eac2",
      "name": "Prep Logging Payload"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cfb51035-7a35-4138-b864-59e068928cc2",
              "name": "final_validation_score",
              "value": "={{ JSON.parse($('Resume Validation').item.json.content.parts[0].text).quality_score }}",
              "type": "string"
            },
            {
              "id": "72192866-7792-4367-8eb6-f875fa2d8249",
              "name": "validation_json",
              "value": "={{ $('Resume Validation').item.json.content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5040,
        2384
      ],
      "id": "3bc0a529-b603-4169-bd59-b142ecc11b0f",
      "name": "Set Validation Output"
    },
    {
      "parameters": {
        "operation": "insert",
        "collection": "n8n_resume_render_log",
        "fields": "=u_id,match_id,treatment_type,base_resume_file_id,template_id,markdown_template,resume_final_markdown,resume_filename,full_name,email,phone,first_name,last_name,gender,geographic_cluster,likely_home_country,company,job_title,job_posting_id,match_score,job_url_direct,validation_score,validation_json,render_status,created_at,job_description,job_location,workflow_mode",
        "options": {
          "useDotNotation": false
        }
      },
      "type": "n8n-nodes-base.mongoDb",
      "typeVersion": 1.2,
      "position": [
        5472,
        2368
      ],
      "id": "da3c8bb4-c7ba-4b81-9439-6833c7523e39",
      "name": "Insert documents",
      "credentials": {
        "mongoDb": {
          "id": "M1ISL6y9nE1CM4BJ",
          "name": "MongoDB account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Find documents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find documents": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove formatting of AI": {
      "main": [
        [
          {
            "node": "Sanitize filename",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent MD template 2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Early Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "AI Agent MD template 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent MD template 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI agent MD template 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent MD template 2": {
      "main": [
        [
          {
            "node": "Remove formatting of AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI agent MD template 3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent MD template 1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent MD template 1": {
      "main": [
        [
          {
            "node": "Remove formatting of AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI agent MD template 3": {
      "main": [
        [
          {
            "node": "Remove formatting of AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Doc Tailoring Agent": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Keyword Extractor": {
      "main": [
        [
          {
            "node": "Doc Tailoring Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resume Validation": {
      "main": [
        [
          {
            "node": "Set Validation Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sanitize filename": {
      "main": [
        [
          {
            "node": "Resume Validation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Early Response": {
      "main": [
        [
          {
            "node": "Keyword Extractor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prep Logging Payload": {
      "main": [
        [
          {
            "node": "Insert documents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Validation Output": {
      "main": [
        [
          {
            "node": "Prep Logging Payload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert documents": {
      "main": [
        [
          {
            "node": "HTTP Request to Workflow 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "wOZUjyffXjodGKNO",
    "timeSavedPerExecution": 15
  },
  "versionId": "a3af3316-0e69-436c-b542-10aa027128c1",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ddd41ed71e058fee91a615d65aac4c1b4f042ff46a10234383bb9a91cd4c923c"
  },
  "id": "A0hN5xwBgcCYQ8hh",
  "tags": [
    {
      "updatedAt": "2025-08-26T18:37:24.706Z",
      "createdAt": "2025-08-26T18:37:24.706Z",
      "id": "kf9yG9s2xGLak03u",
      "name": "AP"
    }
  ]
}